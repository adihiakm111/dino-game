<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dino Run ðŸ¦–</title>
  <style>
    /* Basic reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Default background (day mode) */
    body {
      background: linear-gradient(to top, #c8e6c9 40%, #bbdefb 60%);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      transition: background 1s;
    }

    /* After score 50 â†’ night mode */
    body.night {
      background: linear-gradient(to top, #0d1b2a 40%, #1b263b 60%);
    }

    /* Game canvas */
    canvas {
      display: none;
      background: linear-gradient(to top, #a5d6a7 40%, #b3e5fc 60%);
      border: 3px solid #444;
      border-radius: 10px;
      width: 90vw;
      height: 60vh;
      transition: background 1s;
    }

    /* Canvas night mode */
    canvas.night {
      background: linear-gradient(to top, #222831 40%, #393e46 60%);
    }

    /* Center text menus */
    #menu, #restartMenu { text-align: center; }

    h1 {
      color: #222;
      font-size: 2.5em;
      margin-bottom: 20px;
    }

    /* Buttons */
    button {
      padding: 10px 25px;
      margin: 10px;
      background-color: #4caf50;
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 1.2em;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover { background-color: #388e3c; }

    /* Restart hidden by default */
    #restartMenu { display: none; }

    /* Score text on restart menu */
    #finalScore {
      font-size: 1.5em;
      margin: 10px 0;
      color: #333;
    }

    /* Hard mode text */
    #hardModeText {
      position: absolute;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      color: #ff1744;
      font-size: 2em;
      font-weight: bold;
      text-shadow: 2px 2px 5px black;
      display: none;
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>Dino Run ðŸ¦–</h1>
    <button id="startBtn">Start Game</button>
    <p>Space / Left Click / Tap = Jump<br>Right Click / Double Tap = Crouch</p>
  </div>

  <canvas id="gameCanvas"></canvas>
  <div id="hardModeText">âš¡ Hard Mode Activated!</div>

  <div id="restartMenu">
    <h2>Game Over</h2>
    <p id="finalScore"></p>
    <button id="restartBtn">Restart</button>
  </div>

  <script>
    // -----------------------------
    // CANVAS & MAIN ELEMENTS
    // -----------------------------
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");

    const menu = document.getElementById("menu");
    const restartMenu = document.getElementById("restartMenu");

    const finalScore = document.getElementById("finalScore");
    const hardModeText = document.getElementById("hardModeText");

    // âœ… TOP SCORE SYSTEM
    let topScore = localStorage.getItem("topScore")
      ? parseInt(localStorage.getItem("topScore"))
      : 0;

    // Canvas responsive size
    function resizeCanvas() {
      canvas.width = window.innerWidth * 0.9;
      canvas.height = window.innerHeight * 0.6;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    const dinoImg = new Image();
    dinoImg.src = "dino.png";

    const cactusImg = new Image();
    cactusImg.src = "cactus.png";

    let dino, ground, cactus, score, gameOver, speedIncrease, gameStarted, hardModeOn;

    // -----------------------------
    // START / RESTART GAME
    // -----------------------------
    function initGame() {

      document.body.classList.remove("night");
      canvas.classList.remove("night");
      hardModeText.style.display = "none";

      dino = {
        x: 50,
        y: 0,
        width: 60,
        height: 60,
        vy: 0,
        gravity: 1.3,
        jumpPower: -20,
        grounded: false,
        crouching: false,
      };

      ground = { 
        y: canvas.height - 100,
        height: 100
      };

      cactus = { 
        x: canvas.width,
        y: ground.y - 45,
        width: 45,
        height: 45,
        speed: 6
      };

      score = 0;
      gameOver = false;
      speedIncrease = 0.002;
      gameStarted = true;
      hardModeOn = false;

      canvas.style.display = "block";
      menu.style.display = "none";
      restartMenu.style.display = "none";
    }

    // -----------------------------
    // CONTROLS
    // -----------------------------
    function jump() {
      if (dino.grounded && !dino.crouching) {
        dino.vy = dino.jumpPower;
        dino.grounded = false;
      }
    }

    function crouch(start) {
      dino.crouching = start;
      dino.height = start ? 35 : 60;
    }

    function activateHardMode() {
      if (!hardModeOn) {
        hardModeOn = true;
        hardModeText.style.display = "block";
        setTimeout(() => (hardModeText.style.display = "none"), 2000);
      }
    }

    // -----------------------------
    // UPDATE GAME PHYSICS
    // -----------------------------
    function update() {
      if (!gameStarted || gameOver) return;

      if (score >= 5 && score < 10) cactus.speed = 10;

      if (score >= 10 && score < 50) {
        cactus.speed = 13;
        dino.gravity = 1.6;
        dino.jumpPower = -18;
        activateHardMode();
      }

      if (score >= 50) {
        document.body.classList.add("night");
        canvas.classList.add("night");
      }

      cactus.speed += speedIncrease / 100;

      dino.vy += dino.gravity;
      dino.y += dino.vy;

      if (dino.y + dino.height >= ground.y) {
        dino.y = ground.y - dino.height;
        dino.vy = 0;
        dino.grounded = true;
      }

      cactus.x -= cactus.speed;

      if (cactus.x + cactus.width < 0) {
        cactus.x = canvas.width + Math.random() * 200;
        score++;
        cactus.speed += 0.15;
      }

      const dinoBox = {
        left: dino.x + 10,
        right: dino.x + dino.width - 15,
        top: dino.y + 5,
        bottom: dino.y + dino.height - 5,
      };

      const cactusBox = {
        left: cactus.x + 5,
        right: cactus.x + cactus.width - 5,
        top: cactus.y + 5,
        bottom: cactus.y + cactus.height - 5,
      };

      if (
        dinoBox.left < cactusBox.right &&
        dinoBox.right > cactusBox.left &&
        dinoBox.top < cactusBox.bottom &&
        dinoBox.bottom > cactusBox.top
      ) {
        gameOver = true;
        setTimeout(() => showRestart(), 600);
      }
    }

    // -----------------------------
    // DRAW EVERYTHING
    // -----------------------------
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#6d4c41";
      ctx.fillRect(0, ground.y, canvas.width, ground.height);

      if (cactusImg.complete)
        ctx.drawImage(cactusImg, cactus.x, cactus.y, cactus.width, cactus.height);

      if (dinoImg.complete)
        ctx.drawImage(dinoImg, dino.x, dino.y, dino.width, dino.height);

      ctx.fillStyle = "#222";
      ctx.font = "22px Arial";

      ctx.fillText("Score: " + score, 20, 30);

      // âœ… SHOW TOP SCORE
      ctx.fillText("Top: " + topScore, 20, 60);
    }

    function gameLoop() {
      update();
      draw();
      if (!gameOver) requestAnimationFrame(gameLoop);
    }

    // -----------------------------
    // RESTART SCREEN
    // -----------------------------
    function showRestart() {
      canvas.style.display = "none";
      restartMenu.style.display = "block";
      finalScore.textContent = "Your Score: " + score;

      // âœ… UPDATE TOP SCORE
      if (score > topScore) {
        topScore = score;
        localStorage.setItem("topScore", topScore);
      }
    }

    // -----------------------------
    // EVENTS
    // -----------------------------
    startBtn.addEventListener("click", () => {
      initGame();
      gameLoop();
    });

    restartBtn.addEventListener("click", () => {
      initGame();
      gameLoop();
    });

    window.addEventListener("keydown", (e) => {
      if (e.code === "Space") jump();
    });

    window.addEventListener("mousedown", (e) => {
      if (e.button === 0) jump();
      if (e.button === 2) {
        e.preventDefault();
        crouch(true);
        setTimeout(() => crouch(false), 400);
      }
    });

    window.addEventListener("contextmenu", e => e.preventDefault());

    let lastTap = 0;
    canvas.addEventListener("touchstart", e => {
      const currentTime = new Date().getTime();
      const tapGap = currentTime - lastTap;

      if (tapGap < 300 && tapGap > 0) {
        crouch(true);
        setTimeout(() => crouch(false), 400);
      } else {
        jump();
      }

      lastTap = currentTime;
    });
  </script>
</body>
</html>
